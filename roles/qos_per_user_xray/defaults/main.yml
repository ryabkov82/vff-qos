# Role desired state:
# - present  : install + enable QoS
# - disabled : stop/disable QoS services (fast kill switch), keep files/snippets
# - absent   : fully remove QoS artifacts + optional tc/nft rollback
qos_state: "present"

# Paths
qos_bin_dir: "/usr/local/bin"
qos_etc_dir: "/etc/vff-qos"
qos_log_dir: "/var/log/vff-qos"
qos_state_dir: "/run/vff-qos"

# Interfaces
# qos_if_wan:
# - "auto": detect via IPv4 default route (recommended)
# - "<iface>": explicit interface name (eth0/ens3/...)
qos_if_wan: "auto"
qos_if_ifb: "ifb0"

# Xray node context (container + access log)
qos_container: "remnanode"
qos_xray_access_log_path: "/var/log/supervisor/xray.out.log"

# Default rates if per-email mapping is not implemented
qos_upload_default: "50mbit"
qos_download_default: "80mbit"

qos_wan_ceil: "1gbit"
qos_tc_default_ul: "1gbit"
qos_tc_default_dl: "1gbit"

# Server-side port that Xray accepts on (outer port)
qos_vpn_port: "443"

# Dry-run mode for follow script
qos_dry_run: "0"

# nftables runtime QoS model (Docker-safe)

# Управляет ли роль nft-правилами для QoS
qos_nft_manage: true

# nft table / chains used for ctmark -> fwmark
qos_nft_table_family: "inet"
qos_nft_table_name: "vff_qos_ctmark"

qos_nft_chain_prerouting: "prerouting"
qos_nft_chain_output: "output"

# Reference-only snippet (не применяется через nftables.service)
qos_nft_snippet_path: "/etc/nftables.d/50-vff-qos-ctmark.nft"

# Runtime apply script
qos_nft_apply_script_path: "/usr/local/sbin/vff-qos-nft-apply.sh"

# systemd unit for restoring rules after reboot
qos_nft_unit_name: "vff-qos-nft"
qos_nft_unit_path: "/etc/systemd/system/{{ qos_nft_unit_name }}.service"

# systemd ordering (важно для Docker)
qos_nft_unit_after:
  - "network-online.target"
  - "docker.service"

qos_nft_unit_wants:
  - "network-online.target"

# Persistence behavior
qos_nft_unit_enable: true
qos_nft_unit_start: true

# Removal behavior (absent)
qos_nft_remove_on_absent: true

# tc/ifb bootstrap
qos_tc_enable: true

# Removal behavior (absent)
qos_tc_rollback_on_absent: true

# systemd
qos_systemd_enable: true
qos_timer_onboot_delay_sec: 20
qos_timer_randomized_delay_sec: 3

# Docker management:
# vff-qos does NOT install Docker by default (and we keep it that way).
qos_require_docker_cli: true

# HTB r2q (helps to avoid "quantum is big" warnings and improves shaping granularity)
qos_htb_r2q: 50

# QoS GC (tc cleanup)
qos_gc_enable: true
qos_gc_idle_sec: 14400          # 4 hours
qos_gc_min_age_sec: 600         # 10 minutes
qos_gc_use_conntrack: true
qos_gc_dry_run: false

# QoS GC systemd timer (calendar-based)
qos_gc_timer_calendar: "daily"
qos_gc_timer_randomized_delay_sec: "1h"
qos_gc_timer_persistent: true
qos_gc_timer_accuracy_sec: "5min"
